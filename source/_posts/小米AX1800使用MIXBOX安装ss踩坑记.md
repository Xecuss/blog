---
title: 小米AX1800使用MIXBOX搭建射线版本2踩坑记
date: 2021-05-15 23:05:25
tags: ['网络', 'Linux']
---
在《[0成本实现远程开机](/2021/02/09/0成本实现远程开机/)》这篇文章里提到：路由器本身就是一台小型的电脑，其本身搭载了一个特殊版本的Linux系统。既然是一台小型的电脑，那么就可以在上面搭载各种各样的工具，其中就包括著名的网络工具——射线2。

笔者最近就在AX1800上部署了射线2，这个过程中碰到一些坑。由于笔者既不是计算机专业出身，也没学过嵌入式开发，甚至仅有的一点C语言快要还给老师了，所以在解决这些坑的过程中走了不少弯路。因此将过程记录于此，希望能帮助到有需要的朋友。

## 安装过程

安装过程这里就不再多提了，按照《[0成本实现远程开机](/2021/02/09/0成本实现远程开机/)》里提到的，你的AX1800需要开启SSH并安装MIXBOX，然后可以直接通过MIXBOX安装阴影袜子，这个MIXBOX里安装的阴影袜子里面自带了射线2，只需要添加配置的时候选择射线2的配置即可。

## 问题

### etc分区太小
一上来首先碰到的问题是etc分区空间不够，AX1800的etc分区只有11+ M，安装时会出现```No space left on device```的错误。于是使用```df -h```命令查看了一下剩余空间。重新安装MIXBOX，将其转移到/tmp分区，随后就能顺利安装了。

> ps: 经笔者学嵌入式的朋友告知，这个/tmp分区应该是个临时分区，重启后内容就会消失，目前还没有重启，并不知道会不会消失

### 仅global模式生效
顺利安装并配置好射线2之后，发现这个射线2在禁止名单模式和通行名单模式下均无法正常生效，只有在global模式下才能生效。而且即使是生效了，也无法进行正常的访问操作，会出现各种各样的证书错误。

经过一番搜索，在[这个帖子](https://www.v2ex.com/t/471828)里了解到，这其实是因为DNS问题造成的。又经过一番搜索，最后在射线2的配置文件的任意门部分增加了sniffing选项，终于global模式下能够进行正常的访问操作了。

然而没高兴多久，随即就发现了另一个问题。

### 配置文件重置
笔者在运行射线2的过程中发现，在修改射线2配置过一段时间之后，配置文件总是会重置回之前的状态并且射线2会被重启。因为解决DNS问题需要在配置文件中添加sniffing选项，这样一来就导致每过一段时间就会失效。

百思不得其解下，笔者只好打开其配置脚本试图通过源码来解决问题。

>ps: 通过MIXBOX安装的插件，其配置脚本位于： ${安装位置}/mixbox/apps/${插件名}/scripts/${插件名}.sh

既然是每隔一段时间重置，那么应该和一些定时任务有关，所以笔者首先注意到了start() 中的
```shell
#添加定时更新规则
write_cron_job
```
查看其定义可以看到它使用cru命令添加了三个定时任务：
```shell
```